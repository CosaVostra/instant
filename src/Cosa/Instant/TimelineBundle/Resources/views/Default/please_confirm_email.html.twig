{% extends "::base.html.twig" %}

{% block title %}
  {% trans %}Email confirmation{% endtrans %}
{% endblock %}

{% block body %}
<div class="container">

  <div class="row" style="margin-top:50px; margin-right:15px; margin-left:-10px;">
    <div class="col-md-7">
      <h4>{% trans %}Email confirmation{% endtrans %}</h4>
      <div class="button05" style="width:30%; text-align:center; padding:5px; cursor:pointer;" onclick="$('#email_form').slideToggle();"><a href="#" >{% trans %}Set your email{% endtrans %}</a></div>
      <br />
      <div id="email_form" style="display:none;">
        <h4>{% trans %}Please set your email{% endtrans %}</h4>
    {{ render(controller('CosaInstantUserBundle:Default:setEmailTmp',{'username':app.security.token.user.twitterUsername})) }}
      </div> 
      <br />
      <span class="icon icon-arrow-d" style="font-size:30px; color:#666;"></span>
      <h4>{% trans %}Confirm it{% endtrans %}</h4>
      <span>{% trans %}Check your email box and open the confirmation link{% endtrans %}</span>
    </div> 
  </div> 
</div> 
<br/>
<br/>
<br/>
<br/>
{% include "::footer.html.twig" %}
{% endblock %}

{% block javascripts %}
  <script type="text/javascript">
    function postEmail(){
      $.ajax({
        type: "POST",
        url: "{{path('set_email_tmp')}}",
        data: {
          'form[email]': $('#form_email').val(),
          'form[_token]': $('#form__token').val()
        }
      })
      .done(function( retour ) {
        if(retour.retour){
          var msg = $('<div class="flash-message flash-notice">{% trans %}Confirmation email sent{% endtrans %} !</div>');
        }else{
          var msg = $('<div class="flash-message flash-error">{% trans %}An error has occured{% endtrans %} !</div>');
        }
        $('#flash-messages').append(msg);
        msg.delay(3000).fadeOut(1000);
      });
    }
  </script>
{% endblock %}
